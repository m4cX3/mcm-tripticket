<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Summary</title>
    <link href='https://fonts.googleapis.com/css?family=Poppins' rel='stylesheet'>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin_records_detailed.css') }}" type="text/css">
    <script>
        // Function to deny the request and collect remarks
        function denyRequest(username, travelStartDate, vehicleType, requestedBy) {
            var remarks = prompt("Enter remarks for denial:"); // Prompt user for remarks
            if (remarks === null) {
                // User clicked "Cancel"
                return;
            }
            if (remarks.trim() === '') {
                alert('Please enter remarks.');
                return;
            }
    
            // Send data to the backend via POST request
            fetch('/deny_request', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    'username': username,
                    'remarks': remarks,
                    'start_date': travelStartDate,  // Include start date
                    'vehicle_type': vehicleType,    // Include vehicle type
                    'requested_by': requestedBy     // Include the requester
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Request Denied');
                    window.location.href = '/admin_dashboard?username=' + username;  // Redirect to requests page after denying
                } else {
                    alert('Error denying request');
                }
            })
            .catch(error => console.error('Error:', error));
        }
    </script>    
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="badge-logo">
            <img id="mcm" src="{{ url_for('static', filename='images/mmcm small logo.png') }}" alt="MMCM Logo">
        </div>
        <a href='{{ url_for('admin_dashboard_page', username=username) }}'>Dashboard</a>
        <a href='{{ url_for('admin_requests_page', username=username) }}'>Requests</a>
        <a href='{{ url_for('admin_records_page', username=username) }}'>Records</a>
        <a href="#">Vehicles</a>
    </div>

    <!-- Main content -->
    <div class="main-content">
        {% if details[0]['Approval'] == 0 and details[0]['Remarks'] is none %}
        <h3>This is a pending request</h3>
        {% endif %}
        {% if details[0]['Approval'] == 0 and details[0]['Remarks'] is not none %}
        <h3>Request has been denied</h3>
        {% endif %}
        {% if details[0]['Approval'] == 1 %}
        <h3>Request has been accepted</h3>
        {% endif %}
        <!-- Summary box -->
        <div class="summary-box">
            <ul>
                <li><strong>Date Filled:</strong> {{ details[0]['DateFilled'] }}</li>
                <li><strong>Requested By:</strong> {{ details[0]['RequestedBy'] }}</li>
                <li><strong>Department:</strong> {{ details[0]['Department'] }} </li>
                <li><strong>Purpose of Trip:</strong> {{ details[0]['Purpose_Of_Trip'] }}</li>
                <li><strong>Vehicle Type:</strong> {{ details[0]['VehicleType'] }}</li>
                <br>
                <li><strong>Vehicle Name:</strong> {{ details[0]['VehicleName'] }}</li>
                <li><strong>Vehicle Classification:</strong> {{ details[0]['Classification'] }}</li>
                <li><strong>Vehicle Seating Capcity:</strong> {{ details[0]['SeatingCapacity'] }}</li>
                <li><strong>Vehicle Plate Number:</strong> {{ details[0]['PlateNumber'] }}</li>
                {% if details[0]['Remarks'] is not none %}
                <li><strong>Remarks for Denial: </strong> {{ details[0]['Remarks']}}</li>
                {% endif %}
            </ul>
        </div>
        <div class="details-box">
            <h3>Travel Details:</h3>
            <table>
                <tr>
                    <th>Start Date</th>
                    <th>Start Time</th>
                    <th>Estimated Return</th>
                    <th>Destinations</th>
                </tr>
                {% for travel in details %}
                    <tr>
                        <td>{{ travel.StartDate }}</td>
                        <td>{{ travel.StartTime }}</td>
                        <td>{{ travel.EstimatedReturns }}</td>
                        <td>{{ travel.Destinations }}</td>
                    </tr>
                {% endfor %}
            </table>
        </div>
        {% if details[0]['Approval'] == 0 %}
        <div class="button-container">
            <input type="button" id="deny" name="deny" value="Deny" class="deny-button" onclick="denyRequest('{{ username }}')">
            <input type="submit" id="submit" name="submit" value="Approve" class="approve-button">
        </div>
        {% endif %}
    </div>
</body>
</html>